#!/usr/bin/env BQN

âŸ¨
  Depths
  PrettyPrint
âŸ©â‡

Depths â† {
  pâ†ğ•© # input parent vec
  StepUpâ†{ ğ•Š dâ€¿prevâ€¿cur:
    q â† cur âŠ p
    (d+curâ‰ q)â€¿curâ€¿q
  }
  âŠ‘ StepUpâ€¢_while_(â‰¢Â´1âŠ¸â†“) (ğ•©â‰ âŠ¸â¥Š0)â€¿âŸ¨âŸ©â€¿(â†•â‰ ğ•©)
}

PrettyPrint â† { labels ğ•Š p:
  connectorsâ†"â”€â”Œâ”¬â”â”‚â”´â”œâ”¼â”¤â”‚" # vertical
  spacesâ†1 # vertical
  dâ† Depths p
  maxDepthâ†âŒˆÂ´d
  resultsâ†labels
  # TODO check for maxDepth=0

  DoFamilyâ†{
    # ğ•¨: parent node
    # ğ•©: rendered children
    widthsâ†?
  }
  # Render and record all nodes
  # whose children have depth ğ•©
  DoLayerâ†{
    # ğ•¨: depth at which to handle nodes
    iâ†/d=ğ•©
    Â·â†p DoFamily(âŠâŠ¸âŠ”)â—‹(iâŠ¸âŠ)
  }
}
